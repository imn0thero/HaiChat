<!DOCTYPE html>
<html lang="id">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <link rel="preconnect" href="https://fonts.googleapis.com" />
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
Â  <link href="https://fonts.googleapis.com/css2?family=Modak&family=Barrio&family=Nova+Round&display=swap" rel="stylesheet" />
Â  <meta name="theme-color" content="#000000" />
Â  <link rel="stylesheet" href="style.css" />
Â  <title>SayHai</title>
</head>
<body>

Â  <!-- Baris atas -->
Â  <div class="top-bar">
Â  Â  <button class="logout-btn" onclick="logout()">Logout</button>
Â  Â  <div id="datetime" class="datetime"></div>
Â  Â  <button class="toggle-btn" onclick="toggleDarkMode()" id="modeIcon">ðŸŒž</button>
Â  </div>

Â  <h2 id="welcome"></h2>
Â  <h3>Pengguna Online:</h3>
Â  <div id="onlineUsers"></div>

Â  <div id="chatbox"></div>

Â  <div id="inputArea">
Â  Â  <input type="text" id="msgInput" placeholder="Tulis pesan..." autocomplete="off" />
Â  Â  <button onclick="sendMessage()">Kirim</button>
Â  </div>

Â  <script src="/socket.io/socket.io.js"></script>
Â  <script>
Â  Â  function updateDateTime() {
Â  Â  Â  const now = new Date();
Â  Â  Â  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
Â  Â  Â  const date = now.toLocaleDateString('id-ID', options);
Â  Â  Â  const time = now.toLocaleTimeString('id-ID');
Â  Â  Â  document.getElementById('datetime').textContent = `${date} | ${time}`;
Â  Â  }
Â  Â  setInterval(updateDateTime, 1000);
Â  Â  updateDateTime();

Â  Â  if ("Notification" in window && Notification.permission !== "granted") {
Â  Â  Â  Notification.requestPermission();
Â  Â  }

Â  Â  const savedTheme = localStorage.getItem('theme');
Â  Â  if (savedTheme === 'dark') document.body.classList.add('dark-mode');
Â  Â  updateToggleIcon(savedTheme || 'light');

Â  Â  const username = localStorage.getItem('username');
Â  Â  const password = localStorage.getItem('password');
Â  Â  if (!username || !password) {
Â  Â  Â  window.location.href = 'login.html';
Â  Â  }

Â  Â  document.getElementById('welcome').innerText = "Hai, " + username;

Â  Â  const socket = io();
Â  Â  socket.emit('login', { username, password });

Â  Â  socket.on('loginResult', data => {
Â  Â  Â  if (!data.success) {
Â  Â  Â  Â  alert(data.message || 'Login gagal.');
Â  Â  Â  Â  localStorage.removeItem('username');
Â  Â  Â  Â  localStorage.removeItem('password');
Â  Â  Â  Â  window.location.href = 'login.html';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (data.messages && Array.isArray(data.messages)) {
Â  Â  Â  Â  data.messages.forEach(msg => appendMessage(msg));
Â  Â  Â  }
Â  Â  });

Â  Â  socket.on('message', data => {
Â  Â  Â  appendMessage(data);
Â  Â  Â  if (data.user !== username && Notification.permission === "granted") {
Â  Â  Â  Â  new Notification("Ping");
Â  Â  Â  }
Â  Â  });

Â  Â  socket.on('userList', users => {
Â  Â  Â  const userList = users.map(user => `<li>${escapeHtml(user)} ðŸ”µ</li>`).join('');
Â  Â  Â  document.getElementById('onlineUsers').innerHTML = "<ul>" + userList + "</ul>";
Â  Â  });

Â  Â  function appendMessage(data) {
Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  div.classList.add('message', data.user === username ? 'message-right' : 'message-left');
Â  Â  Â  div.innerHTML = `<strong>${escapeHtml(data.user)}:</strong><br>${escapeHtml(data.text)}`;
Â  Â  Â  const chatbox = document.getElementById('chatbox');
Â  Â  Â  chatbox.appendChild(div);
Â  Â  Â  chatbox.scrollTop = chatbox.scrollHeight;
Â  Â  }

Â  Â  function sendMessage() {
Â  Â  Â  const input = document.getElementById('msgInput');
Â  Â  Â  const text = input.value.trim();
Â  Â  Â  if (text) {
Â  Â  Â  Â  socket.emit('message', { text });
Â  Â  Â  Â  input.value = '';
Â  Â  Â  }
Â  Â  }

Â  Â  function logout() {
Â  Â  Â  localStorage.removeItem('username');
Â  Â  Â  localStorage.removeItem('password');
Â  Â  Â  socket.emit('logout');
Â  Â  Â  window.location.href = 'login.html';
Â  Â  }

Â  Â  function toggleDarkMode() {
Â  Â  Â  document.body.classList.toggle('dark-mode');
Â  Â  Â  const mode = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
Â  Â  Â  localStorage.setItem('theme', mode);
Â  Â  Â  updateToggleIcon(mode);
Â  Â  }

Â  Â  function updateToggleIcon(mode) {
Â  Â  Â  const icon = document.getElementById('modeIcon');
Â  Â  Â  icon.textContent = mode === 'dark' ? 'ðŸŒœ' : 'ðŸŒž';
Â  Â  }

Â  Â  function escapeHtml(str) {
Â  Â  Â  return str.replace(/[&<>"']/g, m => ({
Â  Â  Â  Â  '&': '&amp;',
Â  Â  Â  Â  '<': '&lt;',
Â  Â  Â  Â  '>': '&gt;',
Â  Â  Â  Â  '"': '&quot;',
Â  Â  Â  Â  "'": '&#039;'
Â  Â  Â  })[m]);
Â  Â  }
Â  </script>
</body>
</html>
